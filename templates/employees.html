{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/employee.css') }}">
<script src="{{ url_for('static', filename='js/employee_add.js') }}"></script>
<section class="page-section">
  <div class="page-header">
    <h2>üë• Employee Management</h2>
    <a href="{{ url_for('add_employee') }}" class="btn-primary">‚ûï Add Employee</a>
  </div>

  <div class="table-wrapper">
    <table class="styled-table wide">
      <thead>
        <tr>
          <th>#</th>
          <th>Photo</th>
          <th>Name</th>
          <th>Position</th>
          <th>Email</th>
          <th>Phone</th>
          <th>City</th>
          <th>Status</th>
          <th>Document</th>
          <th class="actions-col">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for emp in employees %}
        <tr>
          <td>{{ loop.index }}</td>
          <td class="avatar-cell">
            
            <!--
            =================================================
            THIS IS THE FIX FOR THE IMAGES
            =================================================
            -->
            {% if emp.image %}
              <!-- 
                We now use cloudinary_url() to get the image from the cloud.
                'public_id=emp.image' uses the ID we saved to the database.
                'height=40', 'width=40', 'crop="fill"' resizes the image on-the-fly.
              -->
              <img class="avatar" src="{{ cloudinary_url(emp.image, height=40, width=40, crop='fill') }}" alt="{{ emp.name }}">
            {% else %}
              <div class="avatar placeholder">No photo</div>
            {% endif %}
            
          </td>
          <td>{{ emp.name }}</td>
          <td>{{ emp.position }}</td>
          <td>{{ emp.email }}</td>
          <td>{{ emp.phone }}</td>
          <td>{{ emp.city }}</td>
          <td>
            <span class="badge {{ 'success' if emp.status=='active' else 'warning' }}">{{ emp.status|capitalize }}</span>
          </td>
          <td>
            
            <!--
            =================================================
            THIS IS THE FIX FOR THE DOCUMENTS
            =================================================
            -->
            {% if emp.document %}
              <!-- 
                We use cloudinary_url() for all uploads.
                'resource_type="raw"' tells Cloudinary this is a file (like a PDF), not an image.
              -->
              <a class="doc-link" href="{{ cloudinary_url(emp.document, resource_type='raw') }}" target="_blank">View</a>
            {% else %}
              ‚Äî
            {% endif %}

          </td>
          <td class="actions">
            <a href="{{ url_for('edit_employee', id=emp.id) }}" class="btn-small btn-warning">‚úè Edit</a>
            
            <!-- This form is correct, it sends a POST request -->
            <form action="{{ url_for('delete_employee', id=emp.id) }}" method="POST" onsubmit="return confirm('Delete this employee?')" style="display:inline;">
              <button type="submit" class="btn-small btn-danger">üóë Delete</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="10" class="empty-state">No employees found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</section>


{% endblock %}
