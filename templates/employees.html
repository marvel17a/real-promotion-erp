{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/employee.css') }}">
<script src="{{ url_for('static', filename='js/employee_add.js') }}"></script>
<section class="page-section">
  <div class="page-header">
    <h2>üë• Employee Management</h2>
    <!-- This link is now correct -->
    <a href="{{ url_for('add_employee') }}" class="btn-primary">‚ûï Add Employee</a>
  </div>

  <div class="table-wrapper">
    <table class="styled-table wide">
      <thead>
        <tr>
          <th>#</th>
          <th>Photo</th>
          <th>Name</th>
          <th>Position</th>
          <th>Email</th>
          <th>Phone</th>
          <th>City</th>
          <th>Status</th>
          <th>Document</th>
          <th class="actions-col">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for emp in employees %}
        <tr>
          <td>{{ loop.index }}</td>
          <td class="avatar-cell">
    {% if emp.image %}
        <img class="avatar"
             src="{{ emp.image }}"
             alt="{{ emp.name }}"
             width="40" height="40"
             style="object-fit: cover; border-radius: 50%;">
    {% else %}
        <div class="avatar placeholder">No photo</div>
    {% endif %}
</td>
          <td>{{ emp.name }}</td>
          <td>{{ emp.position }}</td>
          <td>{{ emp.email }}</td>
          <td>{{ emp.phone }}</td>
          <td>{{ emp.city }}</td>
          <td>
            <span class="badge {{ 'success' if emp.status=='active' else 'warning' }}">{{ emp.status|capitalize }}</span>
          </td>
          <td>
    {% if emp.document %}
        <a class="doc-link" href="{{ emp.document }}" target="_blank">View</a>
    {% else %}
        ‚Äî
    {% endif %}
</td>
          <td class="actions">
            <a href="{{ url_for('edit_employee', id=emp.id) }}" class="btn-small btn-warning">‚úè Edit</a>
            <form action="{{ url_for('delete_employee', id=emp.id) }}" method="POST" onsubmit="return confirm('Delete this employee?')" style="display:inline;">
              <button type="submit" class="btn-small btn-danger">üóë Delete</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr>
          <td colspan="10" class="empty-state">No employees found.</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Slide Drawer -->
<div id="employeeDrawer" class="drawer-overlay">
  <div class="drawer">
    <button class="drawer-close" id="drawerCloseBtn">√ó</button>

    <div class="drawer-header">
      <img id="drawerAvatar" class="drawer-avatar" src="" alt="">
      <div>
        <h2 id="drawerName">Employee Name</h2>
        <p id="drawerRole" class="drawer-role">Role</p>
      </div>
    </div>

    <div class="drawer-content">
      <div class="drawer-item">
        <label>Email:</label>
        <span id="drawerEmail"></span>
      </div>
      <div class="drawer-item">
        <label>Phone:</label>
        <span id="drawerPhone"></span>
      </div>
      <div class="drawer-item">
        <label>City:</label>
        <span id="drawerCity"></span>
      </div>
      <div class="drawer-item">
        <label>Status:</label>
        <span id="drawerStatus"></span>
      </div>
      <div class="drawer-item">
        <label>Document:</label>
        <span id="drawerDoc"></span>
      </div>
      <div class="drawer-item">
        <label>Join Date:</label>
        <span id="drawerJoin"></span>
      </div>
    </div>

    <div class="drawer-actions">
      <a href="#" id="drawerEditBtn" class="drawer-btn edit">Edit</a>
      <a href="#" target="_blank" id="drawerDocBtn" class="drawer-btn doc">Document</a>
    </div>
  </div>
</div>

  <script>
document.querySelectorAll('.btn-view').forEach(btn => {
    btn.addEventListener('click', () => {
        let id = btn.dataset.id;

        fetch(`/api/employees/${id}`)
        .then(res => res.json())
        .then(data => {
            if(!data.ok){ alert("Not found"); return; }

            let emp = data.employee;

            // Fill Drawer Data
            document.getElementById("drawerAvatar").src = emp.image || "";
            document.getElementById("drawerName").textContent = emp.name;
            document.getElementById("drawerRole").textContent = emp.position;
            document.getElementById("drawerEmail").textContent = emp.email;
            document.getElementById("drawerPhone").textContent = emp.phone;
            document.getElementById("drawerCity").textContent = emp.city;
            document.getElementById("drawerStatus").textContent = emp.status;
            document.getElementById("drawerJoin").textContent = emp.join_date || "‚Äî";

            if(emp.document){
                document.getElementById("drawerDoc").innerHTML = `<a href="${emp.document}" target="_blank">Open</a>`;
                document.getElementById("drawerDocBtn").href = emp.document;
            } else {
                document.getElementById("drawerDoc").textContent = "‚Äî";
                document.getElementById("drawerDocBtn").href = "#";
            }

            // Edit button link
            document.getElementById("drawerEditBtn").href = "/edit_employee/" + emp.id;

            // Open drawer
            document.getElementById("employeeDrawer").classList.add("active");
        });
    });
});

// Close Drawer
document.getElementById("drawerCloseBtn").addEventListener("click", () => {
    document.getElementById("employeeDrawer").classList.remove("active");
});

document.getElementById("employeeDrawer").addEventListener("click", (e) => {
    if(e.target.classList.contains("drawer-overlay")){
        document.getElementById("employeeDrawer").classList.remove("active");
    }
});
</script>


</section>
{% endblock %}



