{% extends "base.html" %}

{% block content %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{{ url_for('static', filename='css/evening.css') }}">

<div class="glass-container fade-in-up mb-5">

    <!-- Header -->
    <div class="glass-header text-center mb-4 p-4 position-relative">
        <h1 class="company-name text-gradient fw-bold mb-1">REAL PROMOTION</h1>
        <p class="since-text text-secondary mb-2 small letter-spacing-2">SINCE 2005</p>
        <div class="address-block text-muted small mx-auto bg-white bg-opacity-50 p-2 rounded-3" style="max-width: 600px;">
            <i class="fa-solid fa-location-dot text-primary me-1"></i>
            Real Promotion, G/12, Tulsimangalam Complex, B/h. Trimurti Complex,
            Ghodiya Bazar, Nadiad-387001, Gujarat, India
        </div>
    </div>

    <!-- Main Card -->
    <div class="glass-panel p-3 p-md-4 mb-4">
        
        <!-- TOP CONTROLS ROW (UNCHANGED) -->
        {{ super() }}

        <div id="fetchMsg" class="alert alert-info d-none rounded-3 border-0 shadow-sm"></div>

        <form method="POST" action="{{ url_for('evening') }}" id="eveningForm">

            <!-- HIDDEN FIELDS (UNCHANGED) -->
            <input type="hidden" name="allocation_id" id="allocation_id" value="{{ draft_data.allocation_id if draft_data else '' }}">
            <input type="hidden" name="h_employee" id="h_employee" value="{{ draft_data.employee_id if draft_data else '' }}">
            <input type="hidden" name="h_date" id="h_date" value="{{ draft_data.date if draft_data else '' }}">
            <input type="hidden" name="timestamp" id="timestampInput">
            <input type="hidden" name="status" id="formStatus" value="final">
            <input type="hidden" name="draft_id" value="{{ draft_data.id if draft_data and not last_settle_id else '' }}">

            <!-- TABLE -->
            <div class="table-responsive rounded-4 shadow-sm mb-4 bg-white border">
                <table class="table table-hover align-middle mb-0 text-nowrap" id="stockTable">
                    <thead class="bg-light text-secondary small text-uppercase">
                        <tr>
                            <th class="ps-4">#</th>
                            <th>Img</th>
                            <th>Product Name</th>
                            <th class="text-center">Total</th>
                            <th class="text-center">Sold</th>
                            <th class="text-end">Price</th>
                            <th class="text-end fw-bold text-primary">Amount</th>
                            <th class="text-center">Return</th>
                            <th class="text-center text-muted">Left</th>
                        </tr>
                    </thead>

                    <tbody id="rowsArea"></tbody>

                    <!-- ✅ SUMMARY BOX FOOTER -->
                    <tfoot class="summary-footer">
                        <tr>
                            <td colspan="9">
                                <div class="summary-grid">
                                    <div class="summary-box total">
                                        Total<br><strong id="totTotal">0</strong>
                                    </div>
                                    <div class="summary-box sold">
                                        Sold<br><strong id="totSold">0</strong>
                                    </div>
                                    <div class="summary-box amount">
                                        Amount<br><strong>₹ <span id="totAmount">0.00</span></strong>
                                    </div>
                                    <div class="summary-box return">
                                        Return<br><strong id="totReturn">0</strong>
                                    </div>
                                    <div class="summary-box remain">
                                        Left<br><strong id="totRemain">0</strong>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <!-- BOTTOM SECTION -->
            <div class="row g-4 equal-height">

                <!-- EMPLOYEE FINANCE -->
                <div class="col-lg-6">
                    <div class="glass-panel p-4 h-100 finance-panel">
                        <h5 class="section-title">
                            <i class="fa-solid fa-wallet"></i> Employee Finance
                        </h5>

                        {% if not last_settle_id %}
                        <div class="finance-box credit">
                            <label>CREDIT</label>
                            <input type="number" name="emp_credit_amount" placeholder="Amount ₹">
                            <input type="text" name="emp_credit_note" placeholder="Note">
                        </div>

                        <div class="finance-box debit">
                            <label>DEBIT</label>
                            <input type="number" name="emp_debit_amount" placeholder="Amount ₹">
                            <input type="text" name="emp_debit_note" placeholder="Note">
                        </div>
                        {% else %}
                        <div class="alert alert-light text-center">
                            Finance data saved
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- COLLECTION -->
                <div class="col-lg-6">
                    <div class="glass-panel p-4 h-100">
                        <h5 class="section-title">
                            <i class="fa-solid fa-coins"></i> Collection & Settlement
                        </h5>

                        <div class="settlement-row">
                            <span>Total Sales</span>
                            <span>₹ <input type="number" id="totalAmount" name="totalAmount" readonly></span>
                        </div>

                        <div class="settlement-row">
                            <span>Discount</span>
                            <span><input type="number" id="discount" name="discount"></span>
                        </div>

                        <div class="settlement-row">
                            <span>Online</span>
                            <span><input type="number" id="online" name="online"></span>
                        </div>

                        <div class="settlement-row">
                            <span>Cash</span>
                            <span><input type="number" id="cash" name="cash"></span>
                        </div>

                        <div class="settlement-row balance-due">
                            <span>Balance Due</span>
                            <strong id="dueAmount">0.00</strong>
                        </div>
                    </div>
                </div>

            </div>

            <!-- ACTION BUTTONS (UNCHANGED) -->
            <div class="d-flex justify-content-center gap-3 mt-5">
                <button type="button" onclick="submitForm('draft')" class="btn btn-outline-secondary btn-lg px-5 rounded-pill">
                    Save Draft
                </button>
                <button type="button" onclick="submitForm('final')" class="btn btn-dark btn-lg px-5 rounded-pill">
                    Submit Final
                </button>
            </div>

        </form>
    </div>
</div>

<script src="{{ url_for('static', filename='js/evening.js') }}"></script>
{% endblock %}

