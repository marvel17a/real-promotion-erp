{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

<div class="form-card">
    <h2>‚úèÔ∏è Edit Product</h2>
    <p>Editing: <strong>{{ product.name }}</strong></p>

    <!-- 
      =========================================
          THE ROBUST FIX
          The 'action' attribute is now correct.
      =========================================
    -->
    <form method="POST" action="{{ url_for('edit_product', id=product.id) }}" enctype="multipart/form-data">
        
        <label>Product Name</label>
        <input type="text" name="name" value="{{ product.name }}" required>

        <label>Category</label>
        <input type="text" name="category" value="{{ product.category }}" required>

        <label>Price (‚Çπ)</label>
        <input type="number" step="0.01" name="price" value="{{ product.price }}" required>

        <label>Stock (Current: {{ product.stock }})</label>
        <input type="number" name="stock" value="{{ product.stock }}" required>

        <label>Current Image</label>
        <div>
            <!-- 
              =========================================
                  THE ROBUST FIX
                  This now uses cloudinary_url() to load
                  your live images from the cloud.
              =========================================
            -->
            {% if product.image %}
                <img src="{{ cloudinary_url(product.image, height=100, width=100, crop='fill', radius='5') }}" alt="Current Image" class="product-preview mb-2">
            {% else %}
                <p class="text-muted">No current image.</p>
            {% endif %}
        </div>
        
        <label>Upload New Image (Optional)</label>
        <input type="file" name="image" accept="image/*" onchange="previewImage(event)">
        <img id="imagePreview" class="product-preview" style="display:none;">

        <button type="submit" class="btn-primary">üíæ Update Product</button>
    </form>
</div>

<script>
function previewImage(event) {
    const reader = new FileReader();
    reader.onload = function(){
        const output = document.getElementById('imagePreview');
        output.src = reader.result;
        output.style.display = 'block';
    };
    reader.readAsDataURL(event.target.files[0]);
}
</script>
{% endblock %}
