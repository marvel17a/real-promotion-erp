{% extends "base.html" %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/employee.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/employee_forms.css') }}">
<script src="{{ url_for('static', filename='js/employee_edit.js') }}"></script>

<section class="page-section">
  <div class="page-header">
    <h2>‚úè Edit Employee</h2>
    <a href="{{ url_for('employees') }}" class="btn-secondary">‚Üê Back to Directory</a>
  </div>

  <form class="form-card modern-form" method="POST" enctype="multipart/form-data" id="employeeForm">
    <!-- Hidden ID for JS -->
    <input type="hidden" id="employeeId" value="{{ employee.id }}">

    <!-- Section 1: Job & Contact -->
    <div class="form-section">
      <h4>Job & Contact Information</h4>
      <div class="form-grid-2-col">
        <div class="form-group">
          <label for="name">Name <span>*</span></label>
          <input type="text" id="name" name="name" value="{{ employee.name }}" data-unique="name" required>
          <div class="form-error" data-error-for="name"></div>
        </div>

        <div class="form-group">
          <label for="position">Position <span>*</span></label>
          <input type="text" id="position" name="position" value="{{ employee.position }}" required>
          <div class="form-error" data-error-for="position"></div>
        </div>
        
        <div class="form-group">
          <label for="email">Email <span>*</span></label>
          <input type="email" id="email" name="email" value="{{ employee.email }}" data-unique="email" required>
          <div class="form-error" data-error-for="email"></div>
        </div>

        <div class="form-group">
          <label for="phone">Phone <span>*</span></label>
          <input type="tel" id="phone" name="phone" pattern="[0-9]{10}" value="{{ employee.phone }}" data-unique="phone" required>
          <div class="form-error" data-error-for="phone"></div>
        </div>

        <div class="form-group">
          <label for="city">City <span>*</span></label>
          <input type="text" id="city" name="city" value="{{ employee.city }}" required>
          <div class="form-error" data-error-for="city"></div>
        </div>
        
        <div class="form-group">
          <label for="status">Status <span>*</span></label>
          <select id="status" name="status" required>
            <option value="active" {{ 'selected' if employee.status=='active' }}>Active</option>
            <option value="inactive" {{ 'selected' if employee.status=='inactive' }}>Inactive</option>
          </select>
          <div class="form-error" data-error-for="status"></div>
        </div>
      </div>
    </div>
    
    <!-- Section 2: File Uploads -->
    <div class="form-section">
      <h4>File Uploads</h4>
      <div class="form-grid-2-col">
        <div class="form-group">
          <label>Current Photo</label>
          <div class="preview wide">
            {% if employee.image %}
              <img src="{{ cloudinary_url(employee.image, height=120, width=120, crop='fill', radius='max') }}" alt="{{ employee.name }}">
            {% else %}
              <div class="avatar-placeholder-form">No photo on file</div>
            {% endif %}
          </div>
          <label for="imageInput" class="mt-8">Change Photo (Max 2MB)</label>
          <input type="file" class="form-file-input" name="image" accept="image/png, image/jpeg" id="imageInput">
          <div class="form-error" data-error-for="image"></div>
          <div class="preview wide">
            <img id="imagePreview" alt="New image preview" style="display:none;">
          </div>
        </div>

        <div class="form-group">
          <label>Current Document</label>
          {% if employee.document %}
            <p><a href="{{ cloudinary_url(employee.document)[0] }}" target="_blank" class="doc-link">View current PDF</a></p>
          {% else %}
            <p>No document on file.</p>
          {% endif %}
          <label for="docInput" class="mt-8">Replace Document (PDF Only, Max 5MB)</label>
          <input type="file" class="form-file-input" name="document" accept="application/pdf" id="docInput">
          <div class="form-error" data-error-for="document"></div>
          <p class="file-note" id="docName">No file chosen</p>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button type="submit" class="btn-primary">üíæ Update Employee</button>
      <a href="{{ url_for('employees') }}" class="btn-secondary">Cancel</a>
    </div>
  </form>
</section>
{% endblock %}
