{% extends 'admin_master.html' %}

{% block title %}Employee Finance List{% endblock %}

{% block page_content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/employee_finance.css') }}">

<div class="container-fluid py-4 fade-in-up">
    
    <!-- Header -->
    <div class="page-header">
        <div>
            <h2 class="page-title">Employee Finance</h2>
            <p class="text-muted mb-0">Select an employee to view ledger or add transaction.</p>
        </div>
        <div class="d-flex gap-3">
            <input type="text" id="searchInput" class="input-glass" placeholder="Search employee..." style="width: 250px;">
        </div>
    </div>

    <!-- Employee Table -->
    <div class="glass-container p-0">
        <div class="table-responsive p-3">
            <table class="table-glass">
                <thead>
                    <tr>
                        <th class="ps-4">Employee</th>
                        <th>Position</th>
                        <th>Email</th>
                        <th class="text-end pe-4">Action</th>
                    </tr>
                </thead>
                <tbody id="employeeTable">
                    {% for emp in employees %}
                    <tr>
                        <td class="ps-4">
                            <div class="d-flex align-items-center gap-3">
                                <!-- AVATAR LOGIC -->
                                <div class="avatar-wrapper">
                                    {% if emp.image %}
                                        <!-- Direct URL from database -->
                                        <img src="{{ emp.image }}" class="table-thumb" alt="{{ emp.name }}"
                                             onerror="this.onerror=null;this.src='https://ui-avatars.com/api/?name={{ emp.name }}&background=random&color=fff';">
                                    {% else %}
                                        <!-- Fallback if database field is empty -->
                                        <img src="https://ui-avatars.com/api/?name={{ emp.name }}&background=random&color=fff" class="table-thumb" alt="{{ emp.name }}">
                                    {% endif %}
                                </div>
                                <span class="fw-bold text-dark">{{ emp.name }}</span>
                            </div>
                        </td>
                        <td><span class="badge-soft badge-soft-success">{{ emp.position }}</span></td>
                        <td class="text-muted small">{{ emp.email }}</td>
                        <td class="text-end pe-4">
                            <a href="{{ url_for('emp_ledger', employee_id=emp.id) }}" class="btn-gradient btn-sm text-decoration-none">
                                <i class="fa-solid fa-folder-open me-2"></i>Ledger
                            </a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" class="text-center py-5 text-muted">No employees found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.getElementById('searchInput').addEventListener('keyup', function() {
        let filter = this.value.toLowerCase();
        let rows = document.querySelectorAll('#employeeTable tr');
        rows.forEach(row => {
            let text = row.textContent.toLowerCase();
            row.style.display = text.includes(filter) ? '' : 'none';
        });
    });
</script>
{% endblock %}
