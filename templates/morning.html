{% extends "base.html" %}

{% block content %}
<!-- Dependencies -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<!-- Custom CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/morning_custom.css') }}">

<div class="container-fluid fade-in-up mb-5" style="max-width: 1400px;">

    <!-- HEADER PANEL -->
    <div class="glass-panel p-4 mb-4 mt-4">
        <form id="morningForm" method="POST" action="{{ url_for('morning') }}">
            <!-- Hidden Fields -->
            <input type="hidden" name="timestamp" id="timestampInput">

            <div class="row align-items-center g-3">
                <!-- Profile Photo -->
                <div class="col-auto">
                    <div class="user-img-box">
                        <img id="empPhoto" src="{{ url_for('static', filename='img/default-user.png') }}" alt="User">
                    </div>
                </div>

                <!-- Employee Select -->
                <div class="col-md-3">
                    <label class="small fw-bold text-muted mb-1">EMPLOYEE</label>
                    <select id="employee_id" name="employee_id" class="form-select border-0 shadow-sm fw-bold py-2" required>
                        <option value="">-- Select --</option>
                        {% for emp in employees %}
                        <option value="{{ emp.id }}" data-img="{{ emp.image }}">{{ emp.name }}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Date -->
                <div class="col-md-2">
                    <label class="small fw-bold text-muted mb-1">DATE</label>
                    <input type="text" id="date" name="date" class="form-control border-0 shadow-sm fw-bold py-2 text-center" value="{{ today_date }}" required>
                </div>

                <!-- Clock -->
                <div class="col-md-2">
                    <label class="small fw-bold text-muted mb-1">TIME</label>
                    <div class="bg-white shadow-sm rounded-3 py-2 px-3 fw-bold text-center">
                        <span id="liveClock" class="font-monospace">00:00:00</span>
                    </div>
                </div>

                <!-- Add Item Button (Location Preserved/Aligned Right) -->
                <div class="col-md-3 ms-auto">
                    <label class="d-none d-md-block text-transparent small mb-1">Action</label>
                    <button type="button" id="addRow" class="btn btn-dark w-100 py-2 fw-bold shadow-lg rounded-3">
                        <i class="fa-solid fa-plus me-2"></i> Add Item
                    </button>
                </div>
            </div>
            
            <div id="fetchMsg" class="alert alert-info d-none mt-3 rounded-3 fw-bold small"></div>
    </div>

    <!-- TABLE SECTION -->
    <div class="glass-panel p-0 mb-4 overflow-hidden">
        <div class="table-responsive">
            <table class="custom-table" id="productTable">
                <thead>
                    <tr>
                        <th class="ps-4" style="width: 50px;">#</th>
                        <th style="width: 70px;">Img</th>
                        <th>Product Name</th>
                        <th class="text-center" style="width: 120px;">Opening</th>
                        <th class="text-center" style="width: 120px;">Given</th>
                        <th class="text-center" style="width: 120px;">Total</th> <!-- Colored Box -->
                        <th class="text-center" style="width: 80px;">Action</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Rows generated by JS -->
                </tbody>
                <!-- LAST ROW (Footer) -->
                <tfoot class="table-footer">
                    <tr>
                        <td colspan="3" class="text-end ps-4 text-white-50">TOTALS:</td>
                        
                        <!-- Opening Total -->
                        <td class="text-center">
                            <span id="totalOpening">0</span>
                        </td>
                        
                        <!-- Given Total (Warning Color Text) -->
                        <td class="text-center text-warning">
                            <span id="totalGiven">0</span>
                        </td>
                        
                        <!-- Total All (Info Color Text) -->
                        <td class="text-center text-info">
                            <span id="totalAll">0</span>
                        </td>
                        
                        <!-- Empty Action -->
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!-- SUBMIT BUTTON -->
    <div class="text-center pb-5">
        <button type="submit" class="btn btn-primary px-5 py-3 rounded-pill fw-bold shadow-lg hover-lift">
            <i class="fa-solid fa-check-circle me-2"></i> Submit Allocation
        </button>
    </div>

    </form>
</div>

<!-- Data Pass to JS -->
<script>
    try { window.productsData = {{ products | tojson | safe }}; } 
    catch(e) { window.productsData = []; }
</script>

<!-- Existing Logic -->
<script src="{{ url_for('static', filename='js/morning.js') }}"></script>

<style>
    .hover-lift:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
</style>
{% endblock %}
