{% extends "admin_master.html" %}

{% block page_content %}
<!-- Custom CSS -->
<link rel="stylesheet" href="{{ url_for('static', filename='css/employee.css') }}">

<div class="container-fluid employee-container fade-in-up">

    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold mb-1">Employee Directory</h2>
            <p class="text-muted mb-0">Manage workforce, roles, and departments.</p>
        </div>
        <a href="{{ url_for('add_employee') }}" class="btn btn-primary rounded-pill px-4 shadow-sm fw-bold">
            <i class="fa-solid fa-plus me-2"></i>Add Employee
        </a>
    </div>

    <div class="row g-4">
        
        <!-- LEFT COLUMN: Configurations -->
        <div class="col-lg-4 col-xl-3">
            
            <!-- DEPARTMENTS WIDGET -->
            <div class="glass-panel mb-4">
                <div class="section-header">
                    <h5 class="section-title"><i class="fa-solid fa-layer-group text-primary"></i> Departments</h5>
                    <span class="count-badge">{{ departments|length }}</span>
                </div>
                
                <ul class="management-list">
                    {% for d in departments %}
                    <li class="management-item">
                        <span class="item-name">{{ d.name }}</span>
                        <form action="{{ url_for('delete_department', id=d.id) }}" method="POST" class="d-inline" onsubmit="return confirm('Delete this department?');">
                            <button class="btn btn-sm text-danger border-0 p-0"><i class="fa-regular fa-trash-can"></i></button>
                        </form>
                    </li>
                    {% else %}
                    <li class="text-center text-muted small py-2 fst-italic">No departments found.</li>
                    {% endfor %}
                </ul>

                <form action="{{ url_for('employee_department_add') }}" method="POST" class="mini-form">
                    <input name="department_name" class="input-glass" placeholder="New Dept..." required>
                    <button class="btn-circle-add"><i class="fa-solid fa-plus"></i></button>
                </form>
            </div>

            <!-- POSITIONS WIDGET -->
            <div class="glass-panel">
                <div class="section-header">
                    <h5 class="section-title"><i class="fa-solid fa-briefcase text-warning"></i> Job Roles</h5>
                    <span class="count-badge">{{ positions|length }}</span>
                </div>

                <ul class="management-list">
                    {% for p in positions %}
                    <li class="management-item">
                        <div>
                            <div class="item-name">{{ p.position_name }}</div>
                            <span class="item-meta">{{ p.department_name }}</span>
                        </div>
                        <form action="{{ url_for('delete_position', id=p.id) }}" method="POST" class="d-inline" onsubmit="return confirm('Delete this role?');">
                            <button class="btn btn-sm text-danger border-0 p-0"><i class="fa-regular fa-trash-can"></i></button>
                        </form>
                    </li>
                    {% else %}
                    <li class="text-center text-muted small py-2 fst-italic">No roles found.</li>
                    {% endfor %}
                </ul>

                <form action="{{ url_for('employee_position_add') }}" method="POST" class="mt-3">
                    <div class="mb-2">
                        <select name="department_id" class="input-glass w-100" required>
                            <option value="" disabled selected>Select Department</option>
                            {% for d in departments %}
                            <option value="{{ d.id }}">{{ d.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mini-form mt-0">
                        <input name="position_name" class="input-glass" placeholder="New Role..." required>
                        <button class="btn-circle-add"><i class="fa-solid fa-plus"></i></button>
                    </div>
                </form>
            </div>
        </div>

        <!-- RIGHT COLUMN: EMPLOYEE LIST -->
        <div class="col-lg-8 col-xl-9">
            <div class="glass-panel p-0">
                <div class="p-3 border-bottom d-flex justify-content-between align-items-center bg-white bg-opacity-50">
                    <h5 class="mb-0 fw-bold px-2">All Staff Members</h5>
                    <div class="d-none d-md-block">
                        <input type="text" class="input-glass py-1" placeholder="Search..." style="width: 200px;">
                    </div>
                </div>

                <div class="table-wrapper">
                    <table class="table-glass">
                        <thead>
                            <tr>
                                <th>Profile</th>
                                <th>Role / Dept</th>
                                <th>Contact</th>
                                <th>Status</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for emp in employees %}
                            <tr>
                                <td>
                                    <div class="profile-cell">
                                        <div class="avatar-frame">
                                            <!-- Logic for Profile Picture -->
                                            <img src="{{ url_for('static', filename='uploads/' + emp.image_file) if emp.image_file else 'https://ui-avatars.com/api/?name=' + emp.name + '&background=random&color=fff&size=128' }}" 
                                                 alt="{{ emp.name }}" 
                                                 class="avatar-img">
                                            <span class="status-dot {{ 'active' if emp.status == 'active' else 'inactive' }}"></span>
                                        </div>
                                        <div>
                                            <span class="emp-name">{{ emp.name }}</span>
                                            <span class="emp-email">{{ emp.email }}</span>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span class="role-badge">{{ emp.position_name or 'No Role' }}</span>
                                    <div class="dept-text">{{ emp.department_name or 'Unassigned' }}</div>
                                </td>
                                <td>
                                    <div class="d-flex flex-column gap-1">
                                        <small class="text-dark fw-semibold"><i class="fa-solid fa-phone me-1 text-muted"></i>{{ emp.phone }}</small>
                                        <small class="text-muted"><i class="fa-solid fa-location-dot me-1"></i>{{ emp.city }}</small>
                                    </div>
                                </td>
                                <td>
                                    {% if emp.status == 'active' %}
                                        <span class="badge bg-success bg-opacity-10 text-success border border-success border-opacity-25 rounded-pill px-3">Active</span>
                                    {% else %}
                                        <span class="badge bg-danger bg-opacity-10 text-danger border border-danger border-opacity-25 rounded-pill px-3">Inactive</span>
                                    {% endif %}
                                </td>
                                <td class="text-end">
                                    <a href="{{ url_for('employee_details', id=emp.id) }}" class="action-btn btn-view" title="View Profile">
                                        <i class="fa-regular fa-eye"></i>
                                    </a>
                                    <a href="{{ url_for('edit_employee', id=emp.id) }}" class="action-btn btn-edit" title="Edit Info">
                                        <i class="fa-solid fa-pen"></i>
                                    </a>
                                    <form action="{{ url_for('delete_employee', id=emp.id) }}" method="POST" class="d-inline" onsubmit="return confirm('Remove this employee?');">
                                        <button class="action-btn btn-delete" title="Delete">
                                            <i class="fa-regular fa-trash-can"></i>
                                        </button>
                                    </form>
                                </td>
                            </tr>
                            {% else %}
                            <tr>
                                <td colspan="5" class="text-center py-5">
                                    <div class="opacity-50">
                                        <i class="fa-solid fa-users-slash fa-3x mb-3 text-secondary"></i>
                                        <h6>No employees found</h6>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div
<script src="{{ url_for('static', filename='js/emp.js') }}"></script>
    
{% endblock %}
