{% extends "admin_master.html" %}
{% block page_content %}

<link rel="stylesheet" href="{{ url_for('static', filename='css/glass_theme.css') }}">
<style>
    .table-thumb { width: 45px; height: 45px; object-fit: cover; border-radius: 50%; border: 2px solid #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
</style>

<div class="container py-5">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold text-dark">Employee Master</h2>
    <a href="{{ url_for('add_employee') }}" class="btn btn-glass-primary">
        <i class="fas fa-plus"></i> Add Employee
    </a>
  </div>

  <div class="row g-4">
    <!-- Sidebar Controls -->
    <div class="col-lg-4">
      
      <!-- Departments Card (Moved to Top) -->
      <div class="glass-card mb-4 p-3">
        <h6 class="fw-bold mb-3 border-bottom pb-2">Manage Departments</h6>
        <form action="{{ url_for('employee_department_add') }}" method="POST" class="d-flex mb-3">
          <input name="department_name" class="form-control me-2" placeholder="New department" required>
          <button class="btn btn-sm btn-success">Add</button>
        </form>
        <ul class="list-group list-group-flush bg-transparent">
          {% for d in departments %}
          <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center px-0">
            <span>{{ d.department_name }}</span>
            <a href="{{ url_for('employee_department_delete', id=d.id) }}" class="text-danger" onclick="return confirm('Delete department?');"><i class="fas fa-trash"></i></a>
          </li>
          {% endfor %}
        </ul>
      </div>

      <!-- Positions Card (Moved below Departments) -->
      <div class="glass-card p-3">
        <h6 class="fw-bold mb-3 border-bottom pb-2">Manage Positions</h6>
        <form action="{{ url_for('employee_position_add') }}" method="POST" class="d-flex mb-3">
          <input name="position_name" class="form-control me-2" placeholder="New position" required>
          <button class="btn btn-sm btn-primary">Add</button>
        </form>
        <ul class="list-group list-group-flush bg-transparent">
          {% for pos in positions %}
          <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center px-0">
            <span>{{ pos.position_name }}</span>
            <a href="{{ url_for('employee_position_delete', id=pos.id) }}" class="text-danger" onclick="return confirm('Delete position?');"><i class="fas fa-trash"></i></a>
          </li>
          {% endfor %}
        </ul>
      </div>

    </div>

    <!-- Main Employee Table -->
    <div class="col-lg-8">
      <div class="glass-table-container">
        <table class="glass-table">
          <thead>
            <tr>
              <th>Profile</th>
              <th>Name</th>
              <th>Role</th>
              <th>Contact</th>
              <th>Status</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for emp in employees %}
            <tr>
              <td>
                {% if emp.image %}
                    <img src="{{ cloudinary_url(emp.image)[0] }}" class="table-thumb">
                {% else %}
                    <div class="table-thumb bg-secondary d-flex align-items-center justify-content-center text-white">
                        <i class="fas fa-user"></i>
                    </div>
                {% endif %}
              </td>
              <td>
                <div class="fw-bold">{{ emp.name }}</div>
                <small class="text-muted">{{ emp.department_name }}</small>
              </td>
              <td>{{ emp.position_name or 'â€”' }}</td>
              <td>
                <div>{{ emp.phone }}</div>
                <small class="text-muted">{{ emp.city }}</small>
              </td>
              <td>
                {% if emp.status=='active' %}
                    <span class="badge rounded-pill bg-success bg-opacity-75">Active</span>
                {% else %}
                    <span class="badge rounded-pill bg-danger bg-opacity-75">Inactive</span>
                {% endif %}
              </td>
              <td class="text-end">
                <a href="{{ url_for('employee_details', id=emp.id) }}" class="btn btn-sm btn-outline-info rounded-circle" title="View"><i class="fas fa-eye"></i></a>
                <a href="{{ url_for('edit_employee', id=emp.id) }}" class="btn btn-sm btn-outline-warning rounded-circle" title="Edit"><i class="fas fa-pen"></i></a>
                <form action="{{ url_for('delete_employee', id=emp.id) }}" method="POST" class="d-inline-block" onsubmit="return confirm('Delete employee?');">
                  <button class="btn btn-sm btn-outline-danger rounded-circle" title="Delete"><i class="fas fa-trash"></i></button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<script src="{{ url_for('static', filename='js/emp.js') }}"></script>
{% endblock %}
