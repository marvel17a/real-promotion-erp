{% extends "admin_master.html" %}
{% block page_content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/employee.css') }}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<div class="container py-4">
  <div class="glass-card p-4 mx-auto" style="max-width:980px;">
    <h4 class="mb-3">Edit Employee</h4>

    <form id="editEmployeeForm" action="{{ url_for('edit_employee', id=employee.id) }}" method="POST" enctype="multipart/form-data">
      <div class="row g-3">
        <div class="col-md-6"><label>Name *</label><input name="name" class="form-control" value="{{ employee.name }}" required></div>
        <div class="col-md-6"><label>Email</label><input name="email" type="email" class="form-control" value="{{ employee.email }}"></div>

        <div class="col-md-4"><label>Phone</label><input id="phone" name="phone" class="form-control" value="{{ employee.phone or '' }}"></div>

        <div class="col-md-4"><label>Pincode</label><input id="pincode" name="pincode" class="form-control" maxlength="6" value="{{ employee.pincode or '' }}"></div>

        <div class="col-md-4"><label>City</label><input id="city" name="city" class="form-control" value="{{ employee.city or '' }}"></div>

        <div class="col-md-6"><label>State</label><input id="state" name="state" class="form-control" value="{{ employee.state or '' }}"></div>

        <div class="col-md-6"><label>Date of Birth</label><input name="dob" class="form-control dob-picker" value="{{ employee.dob.strftime('%d-%m-%Y') if employee.dob else '' }}"></div>

        <div class="col-md-6"><label>Address Line 1</label><input name="address_line1" class="form-control" maxlength="150" value="{{ employee.address_line1 or '' }}"></div>

        <div class="col-md-6"><label>Address Line 2</label><input name="address_line2" class="form-control" maxlength="150" value="{{ employee.address_line2 or '' }}"></div>

        <div class="col-md-6">
          <label>Position</label>
          <select name="position_id" class="form-select">
            <option value="">Select</option>
            {% for pos in positions %}
            <option value="{{ pos.id }}" {{ 'selected' if employee.position_id==pos.id else '' }}>{{ pos.position_name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-6">
          <label>Department</label>
          <select name="department_id" class="form-select">
            <option value="">Select</option>
            {% for d in departments %}
            <option value="{{ d.id }}" {{ 'selected' if employee.department_id==d.id else '' }}>{{ d.department_name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-6"><label>Emergency Contact</label><input id="emergency_contact" name="emergency_contact" class="form-control" value="{{ employee.emergency_contact or '' }}"></div>

        <div class="col-md-6"><label>Aadhar No</label><input name="aadhar_no" class="form-control" value="{{ employee.aadhar_no or '' }}"></div>

        <div class="col-md-6">
          <label>Image (Photo)</label>
          <input id="imageInput" name="image" type="file" accept="image/*" class="form-control">
          {% if employee.image %}
            <img id="imagePreview" class="img-preview mt-2" src="{{ cloudinary_url(employee.image)[0] }}" style="max-width:120px;border-radius:8px;">
          {% else %}
            <img id="imagePreview" class="img-preview mt-2" style="display:none;max-width:120px;border-radius:8px;">
          {% endif %}
        </div>

        <div class="col-md-6">
          <label>Document (PDF)</label>
          <input name="document" type="file" accept="application/pdf" class="form-control">
          {% if employee.document %}
            <div class="mt-2">
              <a target="_blank" href="{{ url_for('employee_document', id=employee.id) }}" class="btn btn-sm btn-outline-primary">View current</a>
            </div>
          {% endif %}
        </div>

        <div class="col-12 text-end">
          <button class="btn btn-primary">Update</button>
        </div>

      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="{{ url_for('static', filename='js/employee.js') }}"></script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    if (window.flatpickr) {
      flatpickr(".dob-picker", { dateFormat: "d-m-Y", maxDate: "today", allowInput: true });
    }
  });
</script>
{% endblock %}
