{% extends "base.html" %}
{% block content %}
 <link rel="stylesheet" href="{{ url_for('static', filename='css/inventory.css') }}"> 
<script src="{{ url_for('static', filename='js/product_add_edit.js') }}"></script>

<div class="container-fluid py-4">
  <div class="page-header-vivid">
    <h2>Add New Product</h2>
    <a href="{{ url_for('inventory') }}" class="btn btn-secondary">
      <i class="bi bi-x-lg"></i> Cancel
    </a>
  </div>

  <!-- Note: The action now points to the correct route -->
  <form action="{{ url_for('add_product') }}" method="POST" enctype="multipart/form-data" id="productForm">
    <div class="row g-4">
      <!-- Column 1: Core Info & Pricing -->
      <div class="col-lg-8">
        <div class="card form-card-vivid">
          <div class="card-header">
            <h5><i class="bi bi-box-seam me-2"></i>Product Details</h5>
          </div>
          <div class="card-body p-4">
            <div class="row g-3">
              <div class="col-md-6">
                <label for="name" class="form-label">Product Name <span>*</span></label>
                <input type="text" class="form-control" id="name" name="name" placeholder="Enter product name" required>
                <div class="form-error" data-error-for="name"></div>
              </div>
              <div class="col-md-6">
                <label for="category" class="form-label">Category</label>
                <input type="text" class="form-control" id="category" name="category" placeholder="e.g., Healthcare, Electronics">
                <div class="form-error" data-error-for="category"></div>
              </div>
              
              <div class="col-12"><hr class="my-2"></div>

              <!-- PRICING (NEW FEATURE) -->
              <div class="col-md-4">
                <label for="purchase_price" class="form-label">Purchase Price (₹)</label>
                <input type="number" step="0.01" class="form-control" id="purchase_price" name="purchase_price" placeholder="0.00">
                <div class="form-error" data-error-for="purchase_price"></div>
              </div>
              <div class="col-md-4">
                <label for="price" class="form-label">Selling Price (₹) <span>*</span></label>
                <input type="number" step="0.01" class="form-control" id="price" name="price" placeholder="0.00" required>
                <div class="form-error" data-error-for="price"></div>
              </div>
              <div class="col-md-4">
                <label for="stock" class="form-label">Initial Quantity <span>*</span></label>
                <input type="number" class="form-control" id="stock" name="stock" placeholder="0" required>
                <div class="form-error" data-error-for="stock"></div>
              </div>

            </div>
          </div>
        </div>
      </div>

      <!-- Column 2: Uploads -->
      <div class="col-lg-4">
        <div class="card form-card-vivid">
          <div class="card-header">
            <h5><i class="bi bi-image me-2"></i>Product Image</h5>
          </div>
          <div class="card-body p-4 text-center">
            <div class="preview-box mb-3">
              <img id="imagePreview" class="preview-img-product" alt="Image preview" style="display:none;">
              <span id="imagePlaceholder" class="preview-placeholder">Image preview</span>
            </div>
            <label for="imageInput" class="form-label">Image (Max 2MB)</label>
            <input type="file" class="form-control" name="image" accept="image/png, image/jpeg" id="imageInput">
            <div class="form-error" data-error-for="image"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Actions -->
    <div class="card form-actions mt-4">
      <div class="d-flex justify-content-end">
        <a href="{{ url_for('inventory') }}" class="btn btn-secondary me-2">Cancel</a>
        <button type="submit" class="btn btn-primary px-4">
          <i class="bi bi-check-circle-fill me-2"></i> Save Product
        </button>
      </div>
    </div>
  </form>
</div>

<!-- existing inputs above... -->

<!-- Category select -->
<div class="mb-3">
  <label class="form-label">Category</label>
  <select name="category_id" class="form-select">
    <option value="">-- Select category --</option>
    {% for cat in categories %}
      <option value="{{ cat.id }}">{{ cat.category_name }}</option>
    {% endfor %}
  </select>
</div>

<!-- Initial Stock -->
<div class="mb-3">
  <label class="form-label">Initial Stock</label>
  <input type="number" name="stock" class="form-control" min="0" value="0" required>
</div>

<!-- Low Stock Threshold -->
<div class="mb-3">
  <label class="form-label">Low Stock Threshold</label>
  <input type="number" name="low_stock_threshold" class="form-control" min="0" value="10" required>
  <div class="form-text">If stock ≤ this value the product is considered low-stock.</div>
</div>

<!-- existing submit button... -->


<!-- Custom JS to make image preview work -->
<script>
  document.getElementById('imageInput').addEventListener('change', function(e) {
    const preview = document.getElementById('imagePreview');
    const placeholder = document.getElementById('imagePlaceholder');
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(event) {
        preview.src = event.target.result;
        preview.style.display = 'block';
        placeholder.style.display = 'none';
      }
      reader.readAsDataURL(file);
    } else {
      preview.style.display = 'none';
      placeholder.style.display = 'block';
    }
  });
</script>
{% endblock %}

