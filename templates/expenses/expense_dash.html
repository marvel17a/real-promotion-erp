{% extends 'admin_master.html' %}
{% block title %}Expense Dashboard{% endblock %}

{% block page_content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/expenses.css') }}">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="container-fluid py-4 fade-in-up">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h2 class="fw-bold text-dark mb-0">Financial Overview</h2>
            <p class="text-muted small">Real-time expense analytics.</p>
        </div>
        <div class="d-flex gap-2">
            <a href="{{ url_for('expense_analytics') }}" class="btn btn-outline-primary rounded-pill px-4 shadow-sm fw-bold">
                <i class="fas fa-magic me-2"></i> AI Forecast
            </a>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="row g-4 mb-5">
        <div class="col-md-4">
            <div class="glass-card p-4 position-relative overflow-hidden bg-primary bg-opacity-10 h-100">
                <h6 class="text-uppercase text-primary fw-bold small">This Month</h6>
                <h2 class="fw-bold mb-0 text-dark">₹ {{ "{:,.0f}".format(this_month) }}</h2>
            </div>
        </div>
        <div class="col-md-4">
            <div class="glass-card p-4 position-relative overflow-hidden bg-success bg-opacity-10 h-100">
                <h6 class="text-uppercase text-success fw-bold small">Cash Hand</h6>
                <h2 class="fw-bold mb-0 text-dark">₹ {{ "{:,.0f}".format(fin_status.cash_balance) }}</h2>
            </div>
        </div>
        <div class="col-md-4">
            <div class="glass-card p-4 position-relative overflow-hidden bg-info bg-opacity-10 h-100">
                <h6 class="text-uppercase text-info fw-bold small">Bank Balance</h6>
                <h2 class="fw-bold mb-0 text-dark">₹ {{ "{:,.0f}".format(fin_status.bank_balance) }}</h2>
            </div>
        </div>
    </div>

    <!-- Charts -->
    <div class="row g-4">
        <div class="col-lg-8">
            <div class="glass-card border-0 shadow-lg h-100 p-4">
                <h5 class="fw-bold mb-4">Spending Trend</h5>
                <div style="height: 350px;"><canvas id="trendChart"></canvas></div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="glass-card border-0 shadow-lg h-100 p-4">
                <h5 class="fw-bold mb-4">Categories</h5>
                <div style="height: 300px;"><canvas id="catChart"></canvas></div>
            </div>
        </div>
    </div>
</div>

<script>
    const trendData = {{ monthly_data | tojson }};
    const catData = {{ category_data | tojson }};

    new Chart(document.getElementById('trendChart'), {
        type: 'line',
        data: {
            labels: trendData.labels,
            datasets: [{ label: 'Expense', data: trendData.data, borderColor: '#4f46e5', backgroundColor: 'rgba(79, 70, 229, 0.1)', fill: true, tension: 0.4 }]
        },
        options: { responsive: true, maintainAspectRatio: false }
    });

    new Chart(document.getElementById('catChart'), {
        type: 'doughnut',
        data: {
            labels: catData.labels,
            datasets: [{ data: catData.data, backgroundColor: ['#4f46e5', '#ec4899', '#f59e0b', '#10b981', '#3b82f6'], borderWidth: 0 }]
        },
        options: { responsive: true, maintainAspectRatio: false, cutout: '65%' }
    });
</script>
{% endblock %}
